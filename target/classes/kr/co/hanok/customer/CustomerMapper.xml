<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.hanok.customer.CustomerMapper">
	<!-- 한옥 검색 -->
	<select id="searchHanok" resultType="kr.co.hanok.customer.CustomerVO">
        SELECT
        	ri.image_url AS roomImage,
		    h.hanok_name AS hanokName,
		    r.room_price AS roomPrice 
        FROM 
		    hanoks h
		JOIN 
		    rooms r ON h.hanok_id = r.hanok_id
		JOIN 
		    room_images ri ON r.room_id = ri.room_id
		LEFT JOIN 
		    reservations res ON r.room_id = res.room_id
		    	AND (
	                res.checkin < #{checkOutDate} 
	                AND res.checkout > #{checkInDate}
            	)
        WHERE 
        	h.hanok_name LIKE CONCAT('%', #{location}, '%')
		    AND r.max_capacity >= #{capacity}
		GROUP BY 
		    r.room_id
		LIMIT 1
    </select>
</mapper>